# 🚨 دليل الطوارئ الأمني - Emergency Security Guide

## 🎯 هذا الدليل للاستخدام في حالات الطوارئ فقط!

### 🔥 إجراءات الطوارئ الفورية

#### 1. في حالة تشغيل سكريبت خطر بالخطأ:
```powershell
# إيقاف فوري لجميع عمليات Node.js
taskkill /IM node.exe /F

# التحقق من حالة قاعدة البيانات
dir *.db

# فحص آخر نسخة احتياطية
dir security_backups /O:D
dir automated_backups /O:D
```

#### 2. في حالة تلف قاعدة البيانات:
```powershell
# إيقاف جميع الخدمات
taskkill /IM node.exe /F

# البحث عن آخر نسخة احتياطية سليمة
node emergency_recovery.cjs list-backups

# استعادة من آخر نسخة احتياطية
node emergency_recovery.cjs restore-latest

# التحقق من سلامة الاستعادة
node emergency_recovery.cjs verify-restore
```

#### 3. في حالة فقدان البيانات:
```powershell
# لا تحاول إعادة تشغيل أي خدمات!
# اتبع خطة الاستعادة أدناه فوراً
```

---

## 🛠️ خطة الاستعادة السريعة

### المرحلة 1: التقييم الفوري (5 دقائق)
1. **إيقاف جميع الخدمات فوراً**
2. **تحديد نوع المشكلة ومداها**
3. **تحديد آخر نسخة احتياطية سليمة**

### المرحلة 2: الاستعادة (10-30 دقيقة)
1. **استعادة قاعدة البيانات**
2. **استعادة ملفات الإعداد**
3. **التحقق من سلامة الاستعادة**

### المرحلة 3: التحقق والتشغيل (10-15 دقيقة)
1. **اختبار قاعدة البيانات**
2. **اختبار الخدمات الأساسية**
3. **إعادة تشغيل النظام**

---

## 📋 أوامر الطوارئ السريعة

### إيقاف شامل للنظام:
```powershell
# Windows PowerShell
taskkill /IM node.exe /F
taskkill /IM npm.exe /F
Get-Process | Where-Object {$_.ProcessName -like "*classroom*"} | Stop-Process -Force
```

### فحص حالة قواعد البيانات:
```powershell
# فحص حجم وتاريخ آخر تعديل
Get-ChildItem *.db | Select-Object Name, Length, LastWriteTime | Sort-Object LastWriteTime
```

### البحث عن النسخ الاحتياطية:
```powershell
# البحث في جميع مجلدات النسخ الاحتياطية
Get-ChildItem -Recurse -Include "*backup*.db" | Sort-Object LastWriteTime -Descending
```

---

## 🔍 تشخيص سريع للمشاكل

### فحص لوقات الأمان:
```bash
node security_monitor.cjs analyze
```

### فحص آخر العمليات:
```powershell
# آخر 10 أحداث من لوق الأمان
Get-Content security_audit.log | Select-Object -Last 10
```

### فحص النسخ الاحتياطية المتوفرة:
```bash
node automated_backup_service.cjs status
```

---

## 📞 جهات الاتصال في الطوارئ

### الفريق التقني:
- **المطور الرئيسي**: [إضافة رقم هاتف]
- **مدير النظام**: [إضافة رقم هاتف]  
- **المشرف الأمني**: [إضافة رقم هاتف]

### معلومات الاتصال السريع:
- **البريد الإلكتروني للطوارئ**: emergency@school.edu
- **رقم الدعم الفني**: [إضافة الرقم]

---

## 🚨 السيناريوهات الشائعة وحلولها

### السيناريو 1: تم تشغيل `reset_db.js` بالخطأ
**الحل:**
1. **لا تذعر!** السكريبت الآن محمي بتأكيدات متعددة
2. إذا لم تكمل جميع التأكيدات، البيانات آمنة
3. إذا تم الحذف فعلاً، استخدم آخر نسخة احتياطية

### السيناريو 2: قاعدة البيانات تالفة أو فارغة
**الحل:**
```powershell
# استعادة فورية من آخر نسخة احتياطية
node emergency_recovery.cjs restore-latest --verify
```

### السيناريو 3: النظام لا يعمل بعد التحديث
**الحل:**
```powershell
# العودة للفرع الرئيسي
git checkout main

# استعادة قاعدة البيانات
node emergency_recovery.cjs restore-from-branch main
```

### السيناريو 4: فقدان ملفات الإعداد
**الحل:**
```powershell
# استعادة ملفات الإعداد من النسخة الاحتياطية
node emergency_recovery.cjs restore-config-only
```

---

## ⚡ خطوات الاستعادة السريعة (أقل من 5 دقائق)

### الطريقة التلقائية:
```powershell
# تشغيل سكريبت الاستعادة التلقائية
node emergency_recovery.cjs auto-restore

# سيقوم بـ:
# 1. إيقاف الخدمات
# 2. تحديد آخر نسخة احتياطية سليمة
# 3. استعادة قاعدة البيانات والإعدادات
# 4. التحقق من سلامة الاستعادة
# 5. إعادة تشغيل النظام
```

### الطريقة اليدوية:
```powershell
# 1. إيقاف الخدمات
taskkill /IM node.exe /F

# 2. نسخ آخر قاعدة بيانات سليمة
copy "security_backups\latest\classroom.db" "classroom.db"

# 3. نسخ الإعدادات
copy "security_backups\latest\.env.*" "."

# 4. إعادة تشغيل النظام
npm run start
```

---

## 🔒 إجراءات الأمان بعد الطوارئ

### 1. تحليل السبب:
```bash
node security_monitor.cjs analyze > incident_analysis.txt
```

### 2. تحديث الإجراءات الأمنية:
- مراجعة السكريبتات المستخدمة
- تحديث كلمات المرور إذا لزم الأمر
- تعزيز الحماية

### 3. إنشاء تقرير الحادث:
```bash
node incident_report_generator.cjs create --auto
```

---

## ✅ قائمة التحقق بعد الاستعادة

### التحقق من قاعدة البيانات:
- [ ] قاعدة البيانات تعمل
- [ ] البيانات موجودة ومتكاملة  
- [ ] العلاقات بين الجداول سليمة

### التحقق من النظام:
- [ ] الواجهة الأمامية تعمل
- [ ] الخدمات الخلفية تعمل
- [ ] يمكن تسجيل الدخول
- [ ] البيانات تظهر بشكل صحيح

### التحقق من الأمان:
- [ ] السكريبتات الخطرة محمية
- [ ] نظام المراقبة يعمل
- [ ] النسخ الاحتياطية تعمل
- [ ] لوقات الأمان تسجل الأحداث

---

## 📝 سجل الحوادث

### نموذج تسجيل حادث:
```
التاريخ: ___________
الوقت: ___________
نوع الحادث: ___________
السبب: ___________
الإجراء المتخذ: ___________
وقت الاستعادة: ___________
الدروس المستفادة: ___________
```

---

## 🎯 نصائح لتجنب الطوارئ

1. **لا تشغل السكريبتات الخطرة بدون فهم كامل لوظيفتها**
2. **تأكد من وجود نسخة احتياطية حديثة دائماً**
3. **استخدم بيئة التطوير للاختبار أولاً**
4. **راجع لوقات الأمان بانتظام**
5. **احتفظ بهذا الدليل في مكان يسهل الوصول إليه**

---

**⚠️ تذكر: في حالة الشك، لا تتردد في طلب المساعدة!**

**🔗 روابط مفيدة:**
- دليل المستخدم: `README.md`
- التقارير الأمنية: `security_reports/`
- النسخ الاحتياطية: `security_backups/` و `automated_backups/`

---

*آخر تحديث: ${new Date().toLocaleString('ar-SA')}*
*تم إنشاؤه بواسطة نظام الحماية التلقائي 🛡️*