# 🛡️ دليل استخدام المخطط الأمني التفاعلي المباشر

## نظرة عامة
تم إنشاء نظام مخطط أمني تفاعلي متطور يعرض حالة الأمان في نظام إدارة الفصول الدراسية **مباشرة** ويتحدث تلقائياً مع كل تغيير في النظام.

## 🌐 الوصول للمخطط
**العنوان**: http://localhost:3001
- افتح هذا الرابط في المتصفح
- سيتم تحديث المخطط تلقائياً كل 30 ثانية
- يمكنك التفاعل مع العناصر بالنقر عليها

## 📊 مكونات المخطط

### 1. العقد الرئيسية (النودز)
- **🟢 النظام الأساسي**: حالة النظام العامة مع نقاط الأمان
- **🔵 النسخ الاحتياطية**: آخر 5 نسخ احتياطية بألوان تعكس حداثتها
- **🟡 السكريبتات الخطرة**: حالة الحماية لكل سكريبت
- **🔍 نظام المراقبة**: حالة المراقبة الأمنية النشطة
- **⚙️ خدمة النسخ**: حالة خدمة النسخ الاحتياطية التلقائية

### 2. الألوان ومعانيها
- 🟢 **أخضر**: آمن ومحمي بالكامل
- 🔵 **أزرق**: نشط وتحت المراقبة
- 🟡 **أصفر**: يحتاج انتباه
- 🔴 **أحمر**: خطر - يحتاج إجراء فوري

### 3. الجانبي الأيمن
#### الإحصائيات المباشرة
- عدد النسخ الاحتياطية الإجمالي والحديثة
- عدد السكريبتات المحمية والمعرضة للخطر
- الإنذارات الحديثة والخدمات النشطة

#### الإنذارات الحديثة
- آخر الإنذارات الأمنية (آخر 24 ساعة)
- مستوى الخطورة لكل إنذار

#### آخر الأحداث
- سجل آخر الأحداث من نظم الأمان المختلفة

## 🔄 النظام المباشر (Live)

### التحديث التلقائي
1. **المراقبة المستمرة**: يراقب النظام الملفات والمجلدات التالية:
   - `security_audit.log` - سجل المراجعة الأمنية
   - `backup_service.log` - سجل خدمة النسخ الاحتياطية
   - `recovery_audit.log` - سجل عمليات الاستعادة
   - `security_alerts.log` - سجل الإنذارات الأمنية
   - `backend/reset_db.js` - السكريبت الأخطر
   - `backend/manual_migration.js` - سكريبت الهجرة اليدوية
   - مجلدات النسخ الاحتياطية

2. **التحديث الفوري**: عند اكتشاف أي تغيير، يتم تحديث المخطط خلال ثوانٍ

3. **التحديث الدوري**: تحديث كل 30 ثانية حتى لو لم تحدث تغييرات

### أزرار التحكم
- **🔄 تحديث فوري**: تحديث المخطط على الفور
- **⏸️ إيقاف/تشغيل التحديث**: تحكم في التحديث التلقائي
- **📊 عدادات الوقت**: تظهر آخر تحديث والتحديث القادم

## 🛠️ الخدمات المساندة

### 1. خادم المخطط
```bash
node dashboard_server.cjs
```
- يشغل خادم على المنفذ 3001
- يوفر واجهة ويب تفاعلية
- يدعم التحديث التلقائي

### 2. خدمة المراقبة التلقائية
```bash
node auto_diagram_service.cjs start    # بدء الخدمة
node auto_diagram_service.cjs status   # عرض الحالة
node auto_diagram_service.cjs stop     # إيقاف الخدمة
```

### 3. مولد المخطط
```bash
node live_security_diagram_generator.cjs
```
- ينشئ مخططاً محدثاً بالبيانات الحالية
- يجمع البيانات من جميع المصادر
- ينشئ ملف HTML تفاعلي

## 📈 مؤشرات الأمان

### نقاط الأمان العامة
- **90-100**: ممتاز 🟢
- **75-89**: جيد 🔵  
- **60-74**: تحذير 🟡
- **أقل من 60**: خطر 🔴

### حالات السكريبتات
- **SECURED**: محمي بالكامل (5+ طبقات حماية)
- **PROTECTED**: محمي (3-4 طبقات حماية)
- **VULNERABLE**: معرض للخطر (حماية ضعيفة)
- **AT_RISK**: في خطر (بدون حماية كافية)

### حالات النسخ الاحتياطية
- **fresh**: نسخة حديثة (أقل من 24 ساعة)
- **good**: نسخة جيدة (أقل من أسبوع)
- **old**: نسخة قديمة (أكثر من أسبوع)

## 🎯 التفاعل مع المخطط

### النقر على العقد
- انقر على أي عقدة لعرض تفاصيلها
- تظهر معلومات مثل:
  - مستوى الخطورة
  - مستوى الحماية
  - آخر تعديل
  - حجم الملف/النسخة

### السحب والإفلات
- يمكن سحب العقد لإعادة ترتيب المخطط
- الاتصالات تتحرك مع العقد

### التكبير والتصغير
- استخدم عجلة الماوس للتكبير/التصغير
- اسحب الخلفية لتحريك المخطط

## 🚨 الإنذارات والتنبيهات

### مستويات الإنذار
- **HIGH**: إنذار عالي - يحتاج تدخل فوري
- **MEDIUM**: إنذار متوسط - يحتاج مراجعة
- **LOW**: إنذار منخفض - مجرد إعلام

### أنواع الأحداث المراقبة
- **DANGEROUS_SCRIPT_EXECUTION**: تنفيذ سكريبت خطر
- **BACKUP_FAILED**: فشل في النسخ الاحتياطي
- **RESTORE_FAILED**: فشل في الاستعادة
- **BACKUP_CREATED**: إنشاء نسخة احتياطية جديدة

## 📋 أمثلة عملية

### مراقبة تنفيذ السكريبتات الخطرة
عند تشغيل `reset_db.js`:
1. يتم تسجيل الحدث في `security_audit.log`
2. خدمة المراقبة تكتشف التغيير
3. يتم تحديث المخطط خلال ثوانٍ
4. تظهر إنذارات في اللوحة
5. تتغير ألوان العقد حسب مستوى الخطر

### إنشاء نسخة احتياطية جديدة
عند إنشاء نسخة احتياطية:
1. تظهر نسخة جديدة في المخطط
2. تتحدث الإحصائيات
3. تتغير حالة نظام النسخ الاحتياطي

## 🔧 استكشاف الأخطاء

### إذا لم يظهر المخطط
1. تأكد من تشغيل الخادم: `node dashboard_server.cjs`
2. تأكد من إنشاء المخطط: `node live_security_diagram_generator.cjs`
3. افتح http://localhost:3001

### إذا لم يتحدث المخطط تلقائياً
1. تأكد من تشغيل خدمة المراقبة: `node auto_diagram_service.cjs status`
2. ابدء الخدمة إذا لم تكن تعمل: `node auto_diagram_service.cjs start`

### إذا كانت البيانات غير دقيقة
1. أعد إنشاء المخطط: `node live_security_diagram_generator.cjs`
2. أو استخدم زر "التحديث الفوري" في الواجهة

## 📞 الدعم والصيانة

### إيقاف جميع الخدمات
```bash
node auto_diagram_service.cjs stop
# اضغط Ctrl+C في تيرمينال الخادم
```

### عرض حالة الخدمات
```bash
node auto_diagram_service.cjs stats
```

### تحديث فوري
```bash
node auto_diagram_service.cjs update
```

---

**ملاحظة**: هذا النظام مصمم ليكون "حياً" ويعكس الحالة الفعلية لنظام الأمان. كلما حدثت تغييرات في النظام، ستراها مباشرة في المخطط! 🎯